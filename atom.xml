<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>creantan</title>
  <subtitle>xiaoputaobaba</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.moesoft.com/"/>
  <updated>2017-09-05T06:39:04.000Z</updated>
  <id>http://www.moesoft.com/</id>
  
  <author>
    <name>creantan</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>IOS游戏加速原理与实现</title>
    <link href="http://www.moesoft.com/2017/09/05/IOS%E6%B8%B8%E6%88%8F%E5%8A%A0%E9%80%9F%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/"/>
    <id>http://www.moesoft.com/2017/09/05/IOS游戏加速原理与实现/</id>
    <published>2017-09-05T06:33:58.000Z</published>
    <updated>2017-09-05T06:39:04.000Z</updated>
    
    <content type="html"><![CDATA[<p>游戏助手（如XX助手）有一项游戏加速功能，实现原理其实非常简单，直接hook <code>gettimeofday</code>。</p>
<p>实现tweak代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">//  speedup.xm</div><div class="line">//  create by creantan on 14-10-23</div><div class="line">static int (*orig_gettimeofday)(struct timeval * __restrict, void * __restrict);</div><div class="line">static int mygettimeofday(struct timeval*tv,struct timezone *tz ) &#123;</div><div class="line">    int ret = orig_gettimeofday(tv,tz);</div><div class="line">    if (ret == 0) &#123;</div><div class="line">        tv-&gt;tv_usec *= SPEEDLEVEL;</div><div class="line">        tv-&gt;tv_sec *= SPEEDLEVEL;</div><div class="line">    &#125;</div><div class="line">    return ret;</div><div class="line">&#125;</div><div class="line">%ctor &#123;</div><div class="line">    MSHookFunction((void *)MSFindSymbol(NULL,&quot;_gettimeofday&quot;), (void *)mygettimeofday, (void **)&amp;orig_gettimeofday);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;游戏助手（如XX助手）有一项游戏加速功能，实现原理其实非常简单，直接hook &lt;code&gt;gettimeofday&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;实现tweak代码如下：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td c
    
    </summary>
    
      <category term="BLOG" scheme="http://www.moesoft.com/categories/BLOG/"/>
    
    
      <category term="tweak" scheme="http://www.moesoft.com/tags/tweak/"/>
    
      <category term="游戏加速" scheme="http://www.moesoft.com/tags/%E6%B8%B8%E6%88%8F%E5%8A%A0%E9%80%9F/"/>
    
  </entry>
  
  <entry>
    <title>MAC平台下的crackme两例分析</title>
    <link href="http://www.moesoft.com/2017/09/05/MAC%E5%B9%B3%E5%8F%B0%E4%B8%8B%E7%9A%84crackme%E4%B8%A4%E4%BE%8B%E5%88%86%E6%9E%90/"/>
    <id>http://www.moesoft.com/2017/09/05/MAC平台下的crackme两例分析/</id>
    <published>2017-09-05T06:00:23.000Z</published>
    <updated>2017-09-05T06:23:00.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="工具列表："><a href="#工具列表：" class="headerlink" title="工具列表："></a>工具列表：</h3><ul>
<li>Hopper disassembler（静态分析）</li>
<li>lldb （动态调试）</li>
</ul>
<p>先来个最简单的，直接用Hopper disassembler分析：<br>直接把第一个crackme拖到Hopper里面，看下左边窗口，看下这个crackme的Labels</p>
<p>很容易就找到这个methed实现<code>methImpl_AppDelegate_checkifisok_</code><br>点击它看下汇编：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div></pre></td><td class="code"><pre><div class="line">0x0000000100001110 55                              push       rbp</div><div class="line">0x0000000100001111 4889E5                          mov        rbp, rsp</div><div class="line">0x0000000100001114 4883EC70                        sub        rsp, 0x70</div><div class="line">0x0000000100001118 488D0551180000                  lea        rax, qword [ds:cfstring_Length_of_the_serial_string_is___lx] ; @&quot;Length of the serial string is: %lx&quot;</div><div class="line">0x000000010000111f 488D0DBA160000                  lea        rcx, qword [ds:objc_msg_length] ; @selector(length)</div><div class="line">0x0000000100001126 4C8D0523180000                  lea        r8, qword [ds:cfstring_Length_of_the_name_string_is___lx] ; @&quot;Length of the name string is: %lx&quot;</div><div class="line">0x000000010000112d 4C8D0DFC170000                  lea        r9, qword [ds:cfstring_uh_] ; @&quot;uh?&quot;</div><div class="line">0x0000000100001134 48897DF8                        mov        qword [ss:rbp-0x70+var_104], rdi</div><div class="line">0x0000000100001138 488975F0                        mov        qword [ss:rbp-0x70+var_96], rsi</div><div class="line">0x000000010000113c 488955E8                        mov        qword [ss:rbp-0x70+var_88], rdx</div><div class="line">0x0000000100001140 4C89CF                          mov        rdi, r9</div><div class="line">0x0000000100001143 488945B0                        mov        qword [ss:rbp-0x70+var_32], rax</div><div class="line">0x0000000100001147 B000                            mov        al, 0x0</div><div class="line">0x0000000100001149 4C8945A8                        mov        qword [ss:rbp-0x70+var_24], r8</div><div class="line">0x000000010000114d 48894DA0                        mov        qword [ss:rbp-0x70+var_16], rcx</div><div class="line">0x0000000100001151 E8C6030000                      call       imp___stubs__NSLog</div><div class="line">0x0000000100001156 488B4DF8                        mov        rcx, qword [ss:rbp-0x70+var_104]</div><div class="line">0x000000010000115a 488B152F190000                  mov        rdx, qword [ds:0x100002a90]</div><div class="line">0x0000000100001161 488B0C11                        mov        rcx, qword [ds:rcx+rdx]</div><div class="line">0x0000000100001165 488B350C160000                  mov        rsi, qword [ds:objc_sel_stringValue] ; @selector(stringValue)</div><div class="line">0x000000010000116c 4889CF                          mov        rdi, rcx</div><div class="line">0x000000010000116f E8B4030000                      call       imp___stubs__objc_msgSend</div><div class="line">0x0000000100001174 488945E0                        mov        qword [ss:rbp-0x70+var_80], rax</div><div class="line">0x0000000100001178 488B45E0                        mov        rax, qword [ss:rbp-0x70+var_80]</div><div class="line">0x000000010000117c 4889C7                          mov        rdi, rax</div><div class="line">0x000000010000117f 488B75A0                        mov        rsi, qword [ss:rbp-0x70+var_16]</div><div class="line">0x0000000100001183 FF1557160000                    call       qword [ds:objc_msg_length]  ; @selector(length)</div><div class="line">0x0000000100001189 488945D8                        mov        qword [ss:rbp-0x70+var_72], rax</div><div class="line">0x000000010000118d 488B75D8                        mov        rsi, qword [ss:rbp-0x70+var_72]</div><div class="line">0x0000000100001191 488B7DA8                        mov        rdi, qword [ss:rbp-0x70+var_24]</div><div class="line">0x0000000100001195 B000                            mov        al, 0x0</div><div class="line">0x0000000100001197 E880030000                      call       imp___stubs__NSLog</div><div class="line">0x000000010000119c 488B4DF8                        mov        rcx, qword [ss:rbp-0x70+var_104]</div><div class="line">0x00000001000011a0 488B15F1180000                  mov        rdx, qword [ds:0x100002a98]</div><div class="line">0x00000001000011a7 488B0C11                        mov        rcx, qword [ds:rcx+rdx]</div><div class="line">0x00000001000011ab 488B35C6150000                  mov        rsi, qword [ds:objc_sel_stringValue] ; @selector(stringValue)</div><div class="line">0x00000001000011b2 4889CF                          mov        rdi, rcx</div><div class="line">0x00000001000011b5 E86E030000                      call       imp___stubs__objc_msgSend</div><div class="line">0x00000001000011ba 488945D0                        mov        qword [ss:rbp-0x70+var_64], rax</div><div class="line">0x00000001000011be 488B45D0                        mov        rax, qword [ss:rbp-0x70+var_64]</div><div class="line">0x00000001000011c2 4889C7                          mov        rdi, rax</div><div class="line">0x00000001000011c5 488B75A0                        mov        rsi, qword [ss:rbp-0x70+var_16]</div><div class="line">0x00000001000011c9 FF1511160000                    call       qword [ds:objc_msg_length]  ; @selector(length)</div><div class="line">0x00000001000011cf 488945C8                        mov        qword [ss:rbp-0x70+var_56], rax</div><div class="line">0x00000001000011d3 488B75C8                        mov        rsi, qword [ss:rbp-0x70+var_56]</div><div class="line">0x00000001000011d7 488B7DB0                        mov        rdi, qword [ss:rbp-0x70+var_32]</div><div class="line">0x00000001000011db B000                            mov        al, 0x0</div><div class="line">0x00000001000011dd E83A030000                      call       imp___stubs__NSLog</div><div class="line">0x00000001000011e2 48817DC80A000000                cmp        qword [ss:rbp-0x70+var_56], 0xa</div><div class="line">0x00000001000011ea 0F86BF000000                    jbe        0x1000012af     //判断密码长度是否大于10</div><div class="line">                                       ; Basic Block Input Regs: rbp -  Killed Regs: &lt;nothing&gt;</div><div class="line">0x00000001000011f0 48817DC80F000000                cmp        qword [ss:rbp-0x70+var_56], 0xf</div><div class="line">0x00000001000011f8 0F83B1000000                    jnc        0x1000012af //判断密码长度是否小于15</div><div class="line">                                       ; Basic Block Input Regs: rbp -  Killed Regs: &lt;nothing&gt;</div><div class="line">0x00000001000011fe 48817DD807000000                cmp        qword [ss:rbp-0x70+var_72], 0x7</div><div class="line">0x0000000100001206 0F86A3000000                    jbe        0x1000012af   //判断用户名长度是否大于7</div><div class="line">                                       ; Basic Block Input Regs: rbp -  Killed Regs: &lt;nothing&gt;</div><div class="line">0x000000010000120c 48817DD80F000000                cmp        qword [ss:rbp-0x70+var_72], 0xf</div><div class="line">0x0000000100001214 0F8395000000                    jnc        0x1000012af   // 判断用户名长度是否小于15</div><div class="line">                                       ; Basic Block Input Regs: &lt;nothing&gt; -  Killed Regs: rax rcx rdx rbp rsi rdi</div><div class="line">0x000000010000121a 488D05CF150000                  lea        rax, qword [ds:objc_msg_isEqualToString_] ; @selector(isEqualToString:)</div><div class="line">0x0000000100001221 488D0D68170000                  lea        rcx, qword [ds:cfstring_]   ; @&quot;&quot;</div><div class="line">0x0000000100001228 488B15D9150000                  mov        rdx, qword [ds:bind__OBJC_CLASS_$_NSCharacterSet]</div><div class="line">0x000000010000122f 488B354A150000                  mov        rsi, qword [ds:objc_sel_alphanumericCharacterSet] ; @selector(alphanumericCharacterSet)</div><div class="line">0x0000000100001236 4889D7                          mov        rdi, rdx</div><div class="line">0x0000000100001239 48894598                        mov        qword [ss:rbp-0x70+var_8], rax</div><div class="line">0x000000010000123d 48894D90                        mov        qword [ss:rbp-0x70+var_0], rcx</div><div class="line">0x0000000100001241 E8E2020000                      call       imp___stubs__objc_msgSend     //获取字母和数字集合 NSCharacterSet *alphanumericSet = [ NSCharacterSetalphanumericCharacterSet ];</div><div class="line">0x0000000100001246 488945C0                        mov        qword [ss:rbp-0x70+var_48], rax</div><div class="line">0x000000010000124a 488B45D0                        mov        rax, qword [ss:rbp-0x70+var_64]</div><div class="line">0x000000010000124e 488B55C0                        mov        rdx, qword [ss:rbp-0x70+var_48]</div><div class="line">0x0000000100001252 488B352F150000                  mov        rsi, qword [ds:objc_sel_stringByTrimmingCharactersInSet_] ; @selector(stringByTrimmingCharactersInSet:)</div><div class="line">0x0000000100001259 4889C7                          mov        rdi, rax</div><div class="line">0x000000010000125c E8C7020000                      call       imp___stubs__objc_msgSend  //格式化密码，去除密码中含alphanumericSet中的字符 NSString *trimmedString = [passwdString stringByTrimmingCharactersInSet:alphanumericSet];</div><div class="line">0x0000000100001261 4889C7                          mov        rdi, rax</div><div class="line">0x0000000100001264 488B7598                        mov        rsi, qword [ss:rbp-0x70+var_8]</div><div class="line">0x0000000100001268 488B5590                        mov        rdx, qword [ss:rbp-0x70+var_0]</div><div class="line">0x000000010000126c FF157E150000                    call       qword [ds:objc_msg_isEqualToString_] ; @selector(isEqualToString:)//判断trimmedString是否和@“”空串相等</div><div class="line">0x0000000100001272 8845BF                          mov        byte [ss:rbp-0x70+var_47], al</div><div class="line">0x0000000100001275 807DBF00                        cmp        byte [ss:rbp-0x70+var_47], 0x0</div><div class="line">0x0000000100001279 0F8418000000                    je         0x100001297   //不等则显示错误</div><div class="line">                                       ; Basic Block Input Regs: rbp -  Killed Regs: rax rsi rdi</div><div class="line">0x000000010000127f 488B45F8                        mov        rax, qword [ss:rbp-0x70+var_104]</div><div class="line">0x0000000100001283 488B3506150000                  mov        rsi, qword [ds:objc_sel_yes] ; @selector(yes)</div><div class="line">0x000000010000128a 4889C7                          mov        rdi, rax</div><div class="line">0x000000010000128d E896020000                      call       imp___stubs__objc_msgSend</div><div class="line">0x0000000100001292 E913000000                      jmp        0x1000012aa</div><div class="line">                                       ; Basic Block Input Regs: rbp -  Killed Regs: rax rsi rdi</div><div class="line">0x0000000100001297 488B45F8                        mov        rax, qword [ss:rbp-0x70+var_104] ; XREF=0x100001279</div><div class="line">0x000000010000129b 488B35F6140000                  mov        rsi, qword [ds:objc_sel_no] ; @selector(no)</div><div class="line">0x00000001000012a2 4889C7                          mov        rdi, rax</div><div class="line">0x00000001000012a5 E87E020000                      call       imp___stubs__objc_msgSend</div><div class="line">                                       ; Basic Block Input Regs: &lt;nothing&gt; -  Killed Regs: &lt;nothing&gt;</div><div class="line">0x00000001000012aa E913000000                      jmp        0x1000012c2                ; XREF=0x100001292</div><div class="line">                                       ; Basic Block Input Regs: rbp -  Killed Regs: rax rsi rdi</div><div class="line">0x00000001000012af 488B45F8                        mov        rax, qword [ss:rbp-0x70+var_104] ; XREF=0x1000011ea, 0x1000011f8, 0x100001206, 0x100001214</div><div class="line">0x00000001000012b3 488B35DE140000                  mov        rsi, qword [ds:objc_sel_no] ; @selector(no)</div><div class="line">0x00000001000012ba 4889C7                          mov        rdi, rax</div><div class="line">0x00000001000012bd E866020000                      call       imp___stubs__objc_msgSend</div><div class="line">                                       ; Basic Block Input Regs: &lt;nothing&gt; -  Killed Regs: rsp rbp</div><div class="line">0x00000001000012c2 4883C470                        add        rsp, 0x70                  ; XREF=0x1000012aa</div><div class="line">0x00000001000012c6 5D                              pop        rbp</div><div class="line">0x00000001000012c7 C3                              ret</div></pre></td></tr></table></figure>
<h4 id="复原代码如下："><a href="#复原代码如下：" class="headerlink" title="复原代码如下："></a>复原代码如下：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> *  用户名密码验证</div><div class="line"> *  用户名密码长度验证，密码字母和数字验证，密码只能包含数字和字母</div><div class="line"> *  @return 返回YES or NO</div><div class="line"> */</div><div class="line">-(BOOL)checkifisok&#123;</div><div class="line">    NSString* name = [nameTextField text];</div><div class="line">    NSString* serial = [serialTextField text];</div><div class="line">    int nameLength = [name length];</div><div class="line">    int serialLength = [serial length];</div><div class="line">    if(serialLength &gt; 10 &amp;&amp; serialLength &lt; 15)&#123;</div><div class="line">        if(nameLength &gt; 7 &amp;&amp; nameLength &lt; 15)&#123;</div><div class="line">            NSCharacterSet *alphanumericSet = [NSCharacterSet alphanumericCharacterSet];</div><div class="line">            NSString *trimmedString = [serial stringByTrimmingCharactersInSet:alphanumericSet];</div><div class="line">            if([trimmedString isEqualToString:@&quot;&quot;])&#123;</div><div class="line">                returnYES;</div><div class="line">            &#125;</div><div class="line">        &#125;else&#123;</div><div class="line">            returnNO</div><div class="line">        &#125;</div><div class="line">    &#125;else&#123;</div><div class="line">        returnNO;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="第二个使用lldb动态调试："><a href="#第二个使用lldb动态调试：" class="headerlink" title="第二个使用lldb动态调试："></a>第二个使用lldb动态调试：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">lldb crackme2.app</div><div class="line">r</div><div class="line">ctl+c</div><div class="line">br s -a 0x2a9e</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div></pre></td><td class="code"><pre><div class="line">0x00002a9e 55                              push      ebp</div><div class="line">0x00002a9f 89E5                            mov       ebp,esp</div><div class="line">0x00002aa1 57                              push      edi</div><div class="line">0x00002aa2 56                              push      esi</div><div class="line">0x00002aa3 53                              push      ebx</div><div class="line">0x00002aa4 83EC3C                          sub       esp,0x3c</div><div class="line">0x00002aa7 A140400000                      mov       eax, dword [ds:objc_msg_length]    ; @selector(length)</div><div class="line">0x00002aac 89442404                        mov        dword [ss:esp+0x4],eax</div><div class="line">0x00002ab0 8B4510                          mov       eax, dword [ss:ebp-0x48+arg_8]</div><div class="line">0x00002ab3 890424                          mov        dword [ss:esp],eax</div><div class="line">0x00002ab6 E8A3250000                      call       imp___jump_table__objc_msgSend</div><div class="line">0x00002abb 83F808                          cmp        eax,0x8   //判断注册码长度是否为8位</div><div class="line">0x00002abe 0F858A010000                    jne       0x2c4e  //不等跳往错误提示</div><div class="line">                                       ; Basic Block Input Regs: ecx ebx ebp -  Killed Regs: eax ecx ebx esp ebp esi edi</div><div class="line">0x00002ac4 A144400000                      mov       eax, dword [ds:objc_msg_lossyCString]; @selector(lossyCString)</div><div class="line">0x00002ac9 BE04000000                      mov       esi,0x4   //esi初始化为4</div><div class="line">0x00002ace 31DB                            xor       ebx,ebx</div><div class="line">0x00002ad0 89442404                        mov        dword [ss:esp+0x4],eax</div><div class="line">0x00002ad4 8B4514                          mov       eax, dword [ss:ebp-0x48+arg_C]</div><div class="line">0x00002ad7 890424                          mov        dword [ss:esp],eax</div><div class="line">0x00002ada E87F250000                      call       imp___jump_table__objc_msgSend</div><div class="line">0x00002adf 890424                          mov        dword [ss:esp],eax</div><div class="line">0x00002ae2 89C7                            mov       edi,eax</div><div class="line">0x00002ae4 E87A250000                      call       imp___jump_table__strlen</div><div class="line">0x00002ae9 31C9                            xor       ecx,ecx</div><div class="line">0x00002aeb 8945D0                          mov        dword [ss:ebp-0x48+var_24],eax</div><div class="line">0x00002aee EB37                            jmp       0x2b27</div><div class="line">                                       ; Basic Block Input Regs: ebx esi edi -  Killed Regs: eax ecx edx ebx ebp esi</div><div class="line">0x00002af0 0FBE041F                        movsx     eax, byte [ds:edi+ebx]             ; XREF=0x2b2a   //取用户名的一个字符</div><div class="line">0x00002af4 43                              inc       ebx  //循环累加器</div><div class="line">0x00002af5 0FAFC6                          imul      eax,esi  //取出来的字符与esi相乘</div><div class="line">0x00002af8 83C604                          add       esi,0x4  //esi+4</div><div class="line">0x00002afb 89C2                            mov       edx,eax</div><div class="line">0x00002afd C1E204                          shl       edx,0x4  //edx &lt;&lt; 0x4</div><div class="line">0x00002b00 29C2                            sub       edx,eax</div><div class="line">0x00002b02 B8AD8BDB68                      mov       eax,0x68db8bad</div><div class="line">0x00002b07 8D8C0A9A020000                  lea       ecx, dword [ds:edx+ecx+0x29a]</div><div class="line">0x00002b0e F7E9                            imul      ecx</div><div class="line">0x00002b10 89C8                            mov       eax,ecx</div><div class="line">0x00002b12 C1F81F                          sar       eax,0x1f</div><div class="line">0x00002b15 C1FA0C                          sar       edx,0xc</div><div class="line">0x00002b18 29C2                            sub       edx,eax</div><div class="line">0x00002b1a 89C8                            mov       eax,ecx</div><div class="line">0x00002b1c 69D210270000                    imul      edx,edx,0x2710</div><div class="line">0x00002b22 29D0                            sub       eax,edx</div><div class="line">0x00002b24 8945E0                          mov        dword [ss:ebp-0x48+var_40],eax</div><div class="line">                                       ; Basic Block Input Regs: ebx ebp -  Killed Regs: &lt;nothing&gt;</div><div class="line">0x00002b27 395DD0                          cmp        dword [ss:ebp-0x48+var_24],ebx   ; XREF=0x2aee</div><div class="line">0x00002b2a 77C4                            jnbe      0x2af0</div><div class="line">                                       ; Basic Block Input Regs: ecx ebx ebp edi -  Killed Regs: eax ecx ebx esp ebp esi</div><div class="line">0x00002b2c 8B45E0                          mov       eax, dword [ss:ebp-0x48+var_40]</div><div class="line">0x00002b2f BE04000000                      mov       esi,0x4</div><div class="line">0x00002b34 31DB                            xor       ebx,ebx</div><div class="line">0x00002b36 C744240878300000                mov        dword [ss:esp+0x8],0x3078         ; @&quot;%i&quot;</div><div class="line">0x00002b3e 8944240C                        mov        dword [ss:esp+0xc],eax</div><div class="line">0x00002b42 A128400000                      mov       eax, dword [ds:objc_msg_stringWithFormat_]; @selector(stringWithFormat:)</div><div class="line">0x00002b47 89442404                        mov        dword [ss:esp+0x4],eax</div><div class="line">0x00002b4b A154400000                      mov       eax, dword [ds:cls_NSString]</div><div class="line">0x00002b50 890424                          mov        dword [ss:esp],eax</div><div class="line">0x00002b53 E806250000                      call       imp___jump_table__objc_msgSend   //将结果格式化为NSString</div><div class="line">0x00002b58 893C24                          mov        dword [ss:esp],edi</div><div class="line">0x00002b5b 8945D8                          mov        dword [ss:ebp-0x48+var_32],eax</div><div class="line">0x00002b5e E800250000                      call       imp___jump_table__strlen</div><div class="line">0x00002b63 31C9                            xor       ecx,ecx</div><div class="line">0x00002b65 8945D4                          mov        dword [ss:ebp-0x48+var_28],eax</div><div class="line">0x00002b68 EB32                            jmp       0x2b9c</div><div class="line">                                       ; Basic Block Input Regs: ebx esi edi -  Killed Regs: eax ecx edx ebx ebp esi</div><div class="line">0x00002b6a 0FBE041F                        movsx     eax, byte [ds:edi+ebx]             ; XREF=0x2b9f</div><div class="line">0x00002b6e 43                              inc       ebx</div><div class="line">0x00002b6f 0FAFC6                          imul      eax,esi</div><div class="line">0x00002b72 83C608                          add       esi,0x8</div><div class="line">0x00002b75 8D1480                          lea       edx, dword [ds:eax+eax*4]</div><div class="line">0x00002b78 8D54502D                        lea       edx, dword [ds:eax+edx*2+0x2d]</div><div class="line">0x00002b7c B8AD8BDB68                      mov       eax,0x68db8bad</div><div class="line">0x00002b81 01D1                            add       ecx,edx</div><div class="line">0x00002b83 F7E9                            imul      ecx</div><div class="line">0x00002b85 89C8                            mov       eax,ecx</div><div class="line">0x00002b87 C1F81F                          sar       eax,0x1f</div><div class="line">0x00002b8a C1FA0C                          sar       edx,0xc</div><div class="line">0x00002b8d 29C2                            sub       edx,eax</div><div class="line">0x00002b8f 89C8                            mov       eax,ecx</div><div class="line">0x00002b91 69D210270000                    imul      edx,edx,0x2710</div><div class="line">0x00002b97 29D0                            sub       eax,edx</div><div class="line">0x00002b99 8945E4                          mov        dword [ss:ebp-0x48+var_44],eax</div><div class="line">                                       ; Basic Block Input Regs: ebx ebp -  Killed Regs: &lt;nothing&gt;</div><div class="line">0x00002b9c 3B5DD4                          cmp       ebx, dword [ss:ebp-0x48+var_28]    ; XREF=0x2b68</div><div class="line">0x00002b9f 72C9                            jc        0x2b6a</div><div class="line">                                       ; Basic Block Input Regs: ebx ebp -  Killed Regs: eax ebx esp ebp esi edi</div><div class="line">0x00002ba1 8B45E4                          mov       eax, dword [ss:ebp-0x48+var_44]</div><div class="line">0x00002ba4 BE04000000                      mov       esi,0x4</div><div class="line">0x00002ba9 31DB                            xor       ebx,ebx</div><div class="line">0x00002bab C744240878300000                mov        dword [ss:esp+0x8],0x3078         ; @&quot;%i&quot;</div><div class="line">0x00002bb3 BF04000000                      mov       edi,0x4</div><div class="line">0x00002bb8 8944240C                        mov        dword [ss:esp+0xc],eax</div><div class="line">0x00002bbc A128400000                      mov       eax, dword [ds:objc_msg_stringWithFormat_]; @selector(stringWithFormat:)</div><div class="line">0x00002bc1 89442404                        mov        dword [ss:esp+0x4],eax</div><div class="line">0x00002bc5 A154400000                      mov       eax, dword [ds:cls_NSString]</div><div class="line">0x00002bca 890424                          mov        dword [ss:esp],eax</div><div class="line">0x00002bcd E88C240000                      call       imp___jump_table__objc_msgSend //将结果格式化为NSString</div><div class="line">0x00002bd2 895C2408                        mov        dword [ss:esp+0x8],ebx</div><div class="line">0x00002bd6 8974240C                        mov        dword [ss:esp+0xc],esi</div><div class="line">0x00002bda 8945DC                          mov        dword [ss:ebp-0x48+var_36],eax</div><div class="line">0x00002bdd A148400000                      mov       eax, dword [ds:objc_msg_substringWithRange_]; @selector(substringWithRange:)</div><div class="line">0x00002be2 89442404                        mov        dword [ss:esp+0x4],eax</div><div class="line">0x00002be6 8B4510                          mov       eax, dword [ss:ebp-0x48+arg_8]</div><div class="line">0x00002be9 890424                          mov        dword [ss:esp],eax</div><div class="line">0x00002bec E86D240000                      call       imp___jump_table__objc_msgSend //截取密码前4位验证</div><div class="line">0x00002bf1 89742408                        mov        dword [ss:esp+0x8],esi</div><div class="line">0x00002bf5 897C240C                        mov        dword [ss:esp+0xc],edi</div><div class="line">0x00002bf9 89C3                            mov       ebx,eax</div><div class="line">0x00002bfb A148400000                      mov       eax, dword [ds:objc_msg_substringWithRange_]; @selector(substringWithRange:)</div><div class="line">0x00002c00 89442404                        mov        dword [ss:esp+0x4],eax</div><div class="line">0x00002c04 8B4510                          mov       eax, dword [ss:ebp-0x48+arg_8]</div><div class="line">0x00002c07 890424                          mov        dword [ss:esp],eax</div><div class="line">0x00002c0a E84F240000                      call       imp___jump_table__objc_msgSend//截取密码后4位验证</div><div class="line">0x00002c0f 891C24                          mov        dword [ss:esp],ebx</div><div class="line">0x00002c12 89C6                            mov       esi,eax</div><div class="line">0x00002c14 8B45D8                          mov       eax, dword [ss:ebp-0x48+var_32]</div><div class="line">0x00002c17 89442408                        mov        dword [ss:esp+0x8],eax</div><div class="line">0x00002c1b A108400000                      mov       eax, dword [ds:objc_msg_isEqual_]  ; @selector(isEqual:)</div><div class="line">0x00002c20 89442404                        mov        dword [ss:esp+0x4],eax</div><div class="line">0x00002c24 E835240000                      call       imp___jump_table__objc_msgSend //判断是否相等</div><div class="line">0x00002c29 84C0                            test      al,al</div><div class="line">0x00002c2b 7421                            je        0x2c4e</div><div class="line">                                       ; Basic Block Input Regs: ebp esi -  Killed Regs: eax edx esp</div><div class="line">0x00002c2d 8B45DC                          mov       eax, dword [ss:ebp-0x48+var_36]</div><div class="line">0x00002c30 893424                          mov        dword [ss:esp],esi</div><div class="line">0x00002c33 89442408                        mov        dword [ss:esp+0x8],eax</div><div class="line">0x00002c37 A108400000                      mov       eax, dword [ds:objc_msg_isEqual_]  ; @selector(isEqual:)</div><div class="line">0x00002c3c 89442404                        mov        dword [ss:esp+0x4],eax</div><div class="line">0x00002c40 E819240000                      call       imp___jump_table__objc_msgSend//判断是否相等</div><div class="line">0x00002c45 BA01000000                      mov       edx,0x1</div><div class="line">0x00002c4a 84C0                            test      al,al</div><div class="line">0x00002c4c 7502                            jne       0x2c50</div><div class="line">                                       ; Basic Block Input Regs: edx -  Killed Regs: edx</div><div class="line">0x00002c4e 31D2                            xor       edx,edx                           ; XREF=0x2abe, 0x2c2b</div><div class="line">                                       ; Basic Block Input Regs: edx -  Killed Regs: eax ebx esp esi edi</div><div class="line">0x00002c50 83C43C                          add       esp,0x3c                         ; XREF=0x2c4c</div><div class="line">0x00002c53 89D0                            mov       eax,edx</div><div class="line">0x00002c55 5B                              pop       ebx</div><div class="line">0x00002c56 5E                              pop       esi</div><div class="line">0x00002c57 5F                              pop       edi</div><div class="line">0x00002c58 C9                              leave     </div><div class="line">0x00002c59 C3                              ret</div></pre></td></tr></table></figure>
<p>####keygen代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">int main(int argc, constchar * argv[]) &#123;</div><div class="line">    @autoreleasepool &#123;</div><div class="line">       </div><div class="line">        unsignedlong nameLength = strlen(argv[1]);</div><div class="line">        constchar* index = argv[1];</div><div class="line">        unsignedint eax = 0;</div><div class="line">        int ecx=0,edx=0,esi = 4;</div><div class="line">        int serial_1=0;</div><div class="line">        long constValue =  0x68db8bad;</div><div class="line">        for (int i = 0; i&lt;nameLength; i++) &#123;</div><div class="line">            eax = (int)(*index);</div><div class="line">            eax = eax * esi;</div><div class="line">            esi+=4;</div><div class="line">            edx = (eax &lt;&lt; 0x4) - eax;</div><div class="line">            ecx = edx + ecx+0x29a;</div><div class="line">            edx = constValue*ecx &gt;&gt; 32;</div><div class="line">            serial_1 = ecx - ((edx &gt;&gt; 0xc)-(ecx &gt;&gt; 0x1f)) * 0x2710;</div><div class="line">            index++;</div><div class="line">           </div><div class="line">        &#125;</div><div class="line">        int serial_2=0;</div><div class="line">        index = argv[1];</div><div class="line">        eax = 0,ecx=0,edx=0,esi = 4;</div><div class="line">       </div><div class="line">        for (int i = 0; i&lt;nameLength; i++) &#123;</div><div class="line">            eax = (int)(*index);</div><div class="line">            eax = eax * esi;</div><div class="line">            esi+=8;</div><div class="line">            edx = eax+(eax+eax*4)*2+0x2d;</div><div class="line">            ecx += edx;</div><div class="line">            edx = constValue*ecx &gt;&gt; 32;</div><div class="line">            serial_2 = ecx - ((edx &gt;&gt; 0xc) - (ecx &gt;&gt; 0x1f)) * 0x2710;</div><div class="line">            index++;</div><div class="line">        &#125;</div><div class="line">        NSLog(@&quot;\nname:%s\nserial:%d%d&quot;,argv[1],serial_1,serial_2);</div><div class="line">    &#125;</div><div class="line">    return0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;工具列表：&quot;&gt;&lt;a href=&quot;#工具列表：&quot; class=&quot;headerlink&quot; title=&quot;工具列表：&quot;&gt;&lt;/a&gt;工具列表：&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;Hopper disassembler（静态分析）&lt;/li&gt;
&lt;li&gt;lldb （动态调试）&lt;/li&gt;

    
    </summary>
    
      <category term="BLOG" scheme="http://www.moesoft.com/categories/BLOG/"/>
    
    
      <category term="mac" scheme="http://www.moesoft.com/tags/mac/"/>
    
      <category term="crackme" scheme="http://www.moesoft.com/tags/crackme/"/>
    
      <category term="hopper" scheme="http://www.moesoft.com/tags/hopper/"/>
    
  </entry>
  
</feed>
